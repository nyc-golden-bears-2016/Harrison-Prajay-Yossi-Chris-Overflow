<% if session[:invalid_answer] %>
  <% session[:invalid_answer].each do |error| %>
    <p><%= error %></p>
  <% end %>
<% session[:invalid_answer] = nil; end %>

<% if session[:vote_error] %>
  <p><%= session[:vote_error] %></p>
<% session[:vote_error] = nil; end %>

<form action="/upvote/questions" method="post">
  <input type="submit" name="upvote" value="upvote" class="upvote"></input>
  <input type="hidden" name="question_id" value="<%= @question.id %>">
</form>

<p><%= count_votes(@question) %></p>

<form action="/downvote/questions" method="post">
  <input type="submit" name="downvote" value="downvote" class="downvote"></input>
  <input type="hidden" name="question_id" value="<%= @question.id %>">
</form>

<h1><%= @question.title %></h1>
<p><%= @question.question_body %></p>
<p>Views: <%= @question.view_count %></p>
<p>Author: <%= @question.user.username %></p>

<hr>

<a href="/questions/<%= @question.id %>/new_comment">add comment</a>
<h4>Question Comments</h4>
<% @question.comments.each do |comment| %>
  <p><%= comment.comment_body %> - <%= comment.user.username %></p>
<% end %>

<hr>

<% if @question.answers.empty? %>
  <p>Be the first to answer this question.</p>
<% else %>
  <% best_answer = get_best_answer(@question) %>
  <% if best_answer %>
    <form action="/upvote/answers" method="post">
      <input type="submit" name="upvote" value="upvote" class="upvote"></input>
      <input type="hidden" name="answer_id" value="<%= best_answer.id %>">
    </form>

    <p><%= count_votes(best_answer) %></p>

    <form action="/downvote/answers" method="post">
      <input type="submit" name="downvote" value="downvote" class="downvote"></input>
      <input type="hidden" name="answer_id" value="<%= best_answer.id %>">
    </form>

    <h3>Best Answer</h3>
    <p><%= best_answer.answer_body %></p>
    <p>Author: <%= best_answer.user.username %></p>

    <hr>

    <a href="/answers/<%= best_answer.id %>/new_comment">add comment</a>
    <h4>Answer Comments</h4>
    <% best_answer.comments.each do |comment| %>
      <p><%= comment.comment_body %> - <%= comment.user.username %></p>
    <% end %>

    <hr>
  <% end %>

    <% @question.answers.each do |answer| %>
      <% p answer %>
      <% unless answer.best_answer == true %>
        <form action="/upvote/answers" method="post">
          <input type="submit" name="upvote" value="upvote" class="upvote"></input>
          <input type="hidden" name="answer_id" value="<%= answer.id %>">
        </form>

        <p><%= count_votes(answer) %></p>

        <form action="/downvote/answers" method="post">
          <input type="submit" name="downvote" value="downvote" class="downvote"></input>
          <input type="hidden" name="answer_id" value="<%= answer.id %>">
        </form>

        <p><%= answer.answer_body %></p>
        <p>Author: <%= answer.user.username %></p>

        <% if @question.user_id == session[:id] %>
          <form action="/answers/best" method="post">
            <input type="submit" name="best_answer" value="Set as best"></input>
            <input type="hidden" name="answer_id" value="<%= answer.id %>">
          </form>
        <% end %>

        <hr>

        <a href="/answers/<%= answer.id %>/new_comment">add comment</a>
        <h4>Answer Comments</h4>
        <% answer.comments.each do |comment| %>
          <p><%= comment.comment_body %> - <%= comment.user.username %></p>
        <% end %>

        <hr>
      <% end %>
  <% end %>
<% end %>

<h2>Your Answer</h2>

<form method="post" action="/answers">

  <input type="textbox" placeholder="Enter your answer" name="answer[answer_body]">
  <input type="hidden" name="answer[question_id]" value="<%= @question.id %>">
  <input type="submit" value="Submit Answer">

</form>
